<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HUGFIT ì¶œì„ì²´í¬</title>
  <style>
    body { font-family: 'Arial'; text-align: center; background: #f7f7f7; padding: 30px; }
    img { max-width: 200px; margin-bottom: 20px; }
    input { padding: 10px; font-size: 16px; width: 80%; margin-bottom: 10px; border: 2px solid #ddd; border-radius: 5px; }
    button {
      padding: 12px 24px; background-color: #4da3ff; border: none;
      color: white; font-size: 16px; border-radius: 5px; cursor: pointer;
    }
    button:hover { background-color: #3d8bdb; }
    p { color: #888; margin-top: 0; }
    .kakao { margin-top: 40px; }
    .kakao button {
      background-color: #fee500; color: #000; font-weight: bold;
    }
    .kakao button:hover { background-color: #e6cf00; }
    .status { 
      padding: 10px; 
      margin: 20px 0; 
      border-radius: 5px; 
      font-weight: bold;
    }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .warning { background: #fff3cd; color: #856404; }
    .info { background: #d1ecf1; color: #0c5460; }
    .member-info {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      text-align: left;
    }
    .member-info h3 {
      margin-top: 0;
      color: #495057;
      text-align: center;
    }
    .info-row {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    .info-row:last-child {
      border-bottom: none;
    }
    .info-label {
      font-weight: bold;
      color: #6c757d;
    }
    .info-value {
      color: #495057;
    }
  </style>
</head>
<body>
  <img src="https://raw.githubusercontent.com/silaskim-0722/hugfitmember-in/0cbe487104764f87d7939df2399a35f9672383c1/hugfit-logo.png" alt="HUGFIT ë¡œê³ " />
  <h2>í—ˆê·¸í• ì¶œì„ ì²´í¬</h2>

  <input type="text" id="name" placeholder="ì˜ˆ: ê¹€ë¯¼ì •" />
  <p>ì˜¤ëŠ˜ ë‚ ì§œ: <span id="today"></span></p>

  <button onclick="markAttendance()">ì¶œì„ì™„ë£Œ</button>

  <div id="statusMessage" style="display: none;"></div>
  <div id="memberInfo" style="display: none;"></div>

  <div class="kakao">
    <a href="https://open.kakao.com/me/fitcouple" target="_blank">
      <button>ì¹´ì¹´ì˜¤í†¡ ë¬¸ì˜í•˜ê¸°</button>
    </a>
  </div>

  <script>
    // í‘œì‹œìš© ë‚ ì§œ
    const now = new Date();
    const displayDate = `${now.getMonth() + 1}ì›” ${now.getDate()}ì¼`;
    document.getElementById("today").innerText = displayDate;

    // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
    function showStatus(message, type = 'info') {
      const statusDiv = document.getElementById('statusMessage');
      statusDiv.textContent = message;
      statusDiv.className = `status ${type}`;
      statusDiv.style.display = 'block';
      
      // 5ì´ˆ í›„ ìë™ ìˆ¨ê¹€
      setTimeout(() => {
        statusDiv.style.display = 'none';
      }, 5000);
    }

    // íšŒì› ì •ë³´ í‘œì‹œ í•¨ìˆ˜
    function showMemberInfo(memberData) {
      const infoDiv = document.getElementById('memberInfo');
      
      let statusText = '';
      let statusClass = '';
      
      if (memberData.type === 'ì¿ í°') {
        statusText = memberData.count > 0 ? `${memberData.count}íšŒ ë‚¨ìŒ` : 'ì‚¬ìš©ì™„ë£Œ';
        statusClass = memberData.count > 0 ? 'success' : 'error';
      } else {
        const today = new Date();
        const expireDate = new Date(memberData.expire);
        const daysLeft = Math.ceil((expireDate - today) / (1000 * 60 * 60 * 24));
        
        if (daysLeft > 0) {
          statusText = `${daysLeft}ì¼ ë‚¨ìŒ`;
          statusClass = daysLeft > 7 ? 'success' : 'warning';
        } else {
          statusText = 'ê¸°ê°„ë§Œë£Œ';
          statusClass = 'error';
        }
      }
      
      infoDiv.innerHTML = `
        <div class="member-info">
          <h3>${memberData.name} ë‹˜ì˜ ì´ìš©ê¶Œ ì •ë³´</h3>
          <div class="info-row">
            <span class="info-label">ë“±ë¡ì¼:</span>
            <span class="info-value">${memberData.regDate}</span>
          </div>
          <div class="info-row">
            <span class="info-label">ì´ìš© ìœ í˜•:</span>
            <span class="info-value">${memberData.type}</span>
          </div>
          <div class="info-row">
            <span class="info-label">ë‚¨ì€ íšŸìˆ˜/ê¸°ê°„:</span>
            <span class="info-value">${memberData.type === 'ì¿ í°' ? `${memberData.count}íšŒ` : `~ ${memberData.expire}`}</span>
          </div>
          <div class="info-row">
            <span class="info-label">ìµœê·¼ ë°©ë¬¸:</span>
            <span class="info-value">${memberData.lastVisit || 'ì—†ìŒ'}</span>
          </div>
          <div class="info-row">
            <span class="info-label">ìƒíƒœ:</span>
            <span class="info-value">
              <span class="status ${statusClass}" style="display: inline-block; padding: 4px 8px; font-size: 12px;">
                ${statusText}
              </span>
            </span>
          </div>
        </div>
      `;
      infoDiv.style.display = 'block';
    }

    function markAttendance() {
      const name = document.getElementById("name").value.trim();
      const today = new Date();
      const dateStr = today.toISOString().split('T')[0];  // YYYY-MM-DD

      if (!name) {
        showStatus("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", "warning");
        return;
      }

      // ê´€ë¦¬ì ì‹œìŠ¤í…œì—ì„œ íšŒì› ì •ë³´ í™•ì¸
      const memberKey = `member_${name}`;
      const memberData = localStorage.getItem(memberKey);
      
      if (!memberData) {
        showStatus("ë“±ë¡ë˜ì§€ ì•Šì€ íšŒì›ì…ë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.", "error");
        return;
      }

      const memberInfo = JSON.parse(memberData);
      
      // ì´ìš© ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
      if (memberInfo.type === 'ì¿ í°' && memberInfo.count <= 0) {
        showStatus("ë‚¨ì€ ì´ìš© íšŸìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.", "error");
        showMemberInfo(memberInfo);
        return;
      }
      
      if (memberInfo.type === 'ê¸°ê°„') {
        const todayDate = new Date();
        const expireDate = new Date(memberInfo.expire);
        if (todayDate > expireDate) {
          showStatus("ì´ìš© ê¸°ê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.", "error");
          showMemberInfo(memberInfo);
          return;
        }
      }

      // ë‹¹ì¼ ì¤‘ë³µ ì¶œì„ í™•ì¸
      if (memberInfo.lastVisit === dateStr) {
        showStatus("ì˜¤ëŠ˜ ì´ë¯¸ ì¶œì„ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.", "warning");
        showMemberInfo(memberInfo);
        return;
      }

      // ì¶œì„ ì²˜ë¦¬
      memberInfo.lastVisit = dateStr;
      
      if (memberInfo.type === 'ì¿ í°') {
        if (memberInfo.count > 0) {
          memberInfo.count--;
        }
      }

      // ê´€ë¦¬ì ì‹œìŠ¤í…œì— ì—…ë°ì´íŠ¸
      localStorage.setItem(memberKey, JSON.stringify(memberInfo));

      // ê°œë³„ ì¶œì„ ê¸°ë¡ë„ ì €ì¥ (ê¸°ì¡´ ë°©ì‹ ìœ ì§€)
      const attendanceKey = `${name}_${dateStr}`;
      localStorage.setItem(attendanceKey, "ì¶œì„ì™„ë£Œ");

      // ì„±ê³µ ë©”ì‹œì§€ì™€ í•¨ê»˜ íšŒì› ì •ë³´ í‘œì‹œ
      showMemberInfo(memberInfo);
      showStatus(`${name} ë‹˜ì˜ ì¶œì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`, "success");

      // 5ì´ˆ í›„ ì™„ë£Œ í™”ë©´ìœ¼ë¡œ ì „í™˜
      setTimeout(() => {
        showCompletionScreen(name, dateStr, memberInfo);
      }, 3000);
    }

    function showCompletionScreen(name, dateStr, memberInfo) {
      // ë‚¨ì€ íšŸìˆ˜/ê¸°ê°„ ì •ë³´
      let remainingInfo = '';
      if (memberInfo.type === 'ì¿ í°') {
        remainingInfo = memberInfo.count > 0 ? 
          `<p style="color: #28a745; font-size: 18px;">ğŸ« ë‚¨ì€ íšŸìˆ˜: <strong>${memberInfo.count}íšŒ</strong></p>` :
          `<p style="color: #dc3545; font-size: 18px;">âš ï¸ ì´ìš©ê¶Œì´ ëª¨ë‘ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.</p>`;
      } else {
        const today = new Date();
        const expireDate = new Date(memberInfo.expire);
        const daysLeft = Math.ceil((expireDate - today) / (1000 * 60 * 60 * 24));
        
        if (daysLeft > 0) {
          remainingInfo = `<p style="color: #28a745; font-size: 18px;">ğŸ“… ë‚¨ì€ ê¸°ê°„: <strong>${daysLeft}ì¼</strong></p>`;
        } else {
          remainingInfo = `<p style="color: #dc3545; font-size: 18px;">âš ï¸ ì´ìš© ê¸°ê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>`;
        }
      }

      document.body.innerHTML = `
        <div style="text-align:center; margin-top:50px;">
          <img src="https://raw.githubusercontent.com/silaskim-0722/hugfitmember-in/0cbe487104764f87d7939df2399a35f9672383c1/hugfit-logo.png" style="width:180px; margin-bottom:30px;">
          <h2 style="color: #175d47;">ì¶œì„ ì™„ë£Œ! ğŸ‰</h2>
          <p style="font-size: 20px; color: #175d47;">
            <strong>${name}</strong> ë‹˜ì˜ <strong>${dateStr}</strong> ì¶œì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
          </p>
          ${remainingInfo}
          <div style="margin: 30px 0;">
            <button onclick="location.reload()" style="background-color: #6c757d; border: none; padding: 10px 20px; font-size: 16px; border-radius: 5px; color: white; margin-right: 10px; cursor: pointer;">
              ë‹¤ì‹œ ì¶œì„í•˜ê¸°
            </button>
          </div>
          <div class="kakao" style="margin-top: 40px;">
            <a href="https://open.kakao.com/me/fitcouple" target="_blank">
              <button style="background-color:#fee500; border:none; padding:10px 20px; font-size:16px; border-radius:5px; color:#000; cursor: pointer;">
                ì¹´ì¹´ì˜¤í†¡ ë¬¸ì˜í•˜ê¸°
              </button>
            </a>
          </div>
        </div>
      `;
    }

    // Enter í‚¤ë¡œ ì¶œì„ ì²˜ë¦¬
    document.getElementById('name').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        markAttendance();
      }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ í¬ì»¤ìŠ¤
    window.onload = function() {
      document.getElementById('name').focus();
    };
  </script>
</body>
</html>